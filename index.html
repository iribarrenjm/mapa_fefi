<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixture Clausura Fefi 2025 - Villa Sahores</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        header {
            background-color: green;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 1.5em;
        }
        #map { height: 80vh; width: 100%; }
        #filter {
            padding: 10px;
            background: #f0f0f0;
        }
        select { padding: 5px; font-size: 1em; }
        @media (max-width: 600px) {
            header { font-size: 1.2em; }
            select { width: 100%; }
        }
    </style>
</head>
<body>

<header>Fixture Clausura Fefi 2025 - Villa Sahores</header>
<div id="filter">
    <label for="fechaSelect">Filtrar por n√∫mero de fecha:</label>
    <select id="fechaSelect">
        <option value="">Todas</option>
    </select>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
    const map = L.map('map').setView([-34.6, -58.45], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    let markers = [];
    let allData = [];

    function addMarkers(data, selectedFecha) {
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        data.forEach(row => {
            const idFecha = row.ID;
            const fecha = row.Fecha;
            const local = row.Local;
            const visitante = row.Visitante;
            const lat = parseFloat(row.latitud);
            const lon = parseFloat(row.longitud);

            if (!isNaN(lat) && !isNaN(lon)) {
                if (!selectedFecha || selectedFecha === idFecha) {
                    const marker = L.marker([lat, lon]).addTo(map);
                    marker.bindPopup(`
                        <b>Fecha ${idFecha}</b><br>
                        ${fecha}<br>
                        ${local} vs ${visitante}<br>
                        <a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank">
                            Ver en Google Maps
                        </a>
                    `);
                    markers.push(marker);
                }
            }
        });
    }

    Papa.parse("clausura.csv", {
        download: true,
        header: true,
        delimiter: ";",
        complete: function(results) {
            allData = results.data.filter(row => row.ID && row.latitud && row.longitud);

            const fechasUnicas = [...new Set(allData.map(row => row.ID))].sort((a, b) => parseInt(a) - parseInt(b));

            const fechaSelect = document.getElementById('fechaSelect');
            fechasUnicas.forEach(fecha => {
                const option = document.createElement('option');
                option.value = fecha;
                option.textContent = fecha;
                fechaSelect.appendChild(option);
            });

            addMarkers(allData, "");

            fechaSelect.addEventListener('change', function() {
                addMarkers(allData, this.value);
            });
        }
    });
</script>

</body>
</html>
