<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Fixture Clausura Fefi 2025 - Villa Sahores</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin: 0; font-family: Arial, sans-serif; }
  header {
    background: #333;
    color: white;
    padding: 10px;
    text-align: center;
    font-size: 18px;
  }
  #controls {
    padding: 10px;
    background: #f0f0f0;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  select {
    padding: 5px;
    font-size: 14px;
  }
  #map { height: calc(100vh - 100px); }
</style>
</head>
<body>

<header>Fixture Clausura Fefi 2025 - Villa Sahores</header>
<div id="controls">
  <label for="dateFilter">Filtrar por fecha:</label>
  <select id="dateFilter">
    <option value="all">Todas</option>
  </select>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const map = L.map('map').setView([-34.6, -58.45], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let markers = [];
let allData = [];

// Cargar CSV
Papa.parse("clausura.csv", {
  download: true,
  header: true,
  complete: function(results) {
    allData = results.data;
    populateDateFilter();
    plotMarkers("all");
  }
});

// Poblar el filtro de fechas
function populateDateFilter() {
  let dates = [...new Set(allData.map(row => row.Fecha.trim()))];
  dates.sort((a,b) => {
    let [da,ma,ya] = a.split("/").map(Number);
    let [db,mb,yb] = b.split("/").map(Number);
    return new Date(ya, ma-1, da) - new Date(yb, mb-1, db);
  });
  
  const select = document.getElementById("dateFilter");
  dates.forEach(date => {
    let option = document.createElement("option");
    option.value = date;
    option.textContent = date;
    select.appendChild(option);
  });

  select.addEventListener("change", () => {
    plotMarkers(select.value);
  });
}

// Mostrar marcadores filtrados
function plotMarkers(filterDate) {
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  allData.forEach(row => {
    if (!row.Latitud || !row.Longitud) return;
    if (filterDate !== "all" && row.Fecha.trim() !== filterDate) return;

    const marker = L.marker([parseFloat(row.Latitud), parseFloat(row.Longitud)]).addTo(map);
    let popupContent = `<b>${row.Club}</b><br>Fecha: ${row.Fecha}<br>`;
    popupContent += `<a href="https://www.google.com/maps?q=${row.Latitud},${row.Longitud}" target="_blank">Abrir en Google Maps</a>`;
    marker.bindPopup(popupContent);
    markers.push(marker);
  });
}
</script>
</body>
</html>
